---
- name: Получить недостающие факты о хосте
  ansible.builtin.setup:
    gather_subset: min
  when: ansible_os_family is not defined

- name: 'Для семейства Debian: сгенерировать локаль, если она еще не существует в системе'
  community.general.locale_gen:
    name: '{{ item }}'
    state: present
  loop:
    - '{{ formats }}'
    - '{{ language }}'
  become: true
  when: ansible_os_family == 'Debian'

- name: Определить файл для хранения конфигурации локалей
  ansible.builtin.set_fact:
    _locale_conf_file: '{{ _system_locale_file[ ansible_os_family | lower ] }}'

- name: Настроить системные локали
  ansible.builtin.copy:
    content: |
      # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
      # #  Managed by Ansible                                                     # #
      # #  DO NOT EDIT THIS FILE MANUALLY                                         # #
      # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
      LANG="{{ language }}"
      LC_NUMERIC="{{ formats }}"
      LC_TIME="{{ formats }}"
      LC_MONETARY="{{ formats }}"
      LC_PAPER="{{ formats }}"
      LC_NAME="{{ formats }}"
      LC_ADDRESS="{{ formats }}"
      LC_TELEPHONE="{{ formats }}"
      LC_MEASUREMENT="{{ formats }}"
      LC_IDENTIFICATION="{{ formats }}"
    dest: '{{ _locale_conf_file }}'
    mode: 0644
  become: true
