# Remmina

Установка desktop-приложения [Remmina](https://remmina.org/) для доступа на удаленные хосты через SSH и RDP.

Для Ubuntu, начиная с версии **1.4.8**, прекращена поддержка официального PPA-репозитория
приложения ([PPA is kill](https://remmina.org/oh-flatpak/)). Поэтому используется **Snap**-пакет.

## Переменные Ansible-роли

#### Обязательные

<table>
<thead>
<th>
Переменная
</th>
<th>
Описание
</th>
<tr>
</thead>
<tbody>
<td valign="top">

`connections_dir`

</td>
<td valign="top">

Каталог, где хранятся файлы-профили соединений. Будет создан, если не существует.

Ограничения со стороны SNAP:

* должен располагаться внутри home-каталога пользователя
* в пути не должен встречаться _скрытый_ каталог (с точкой в начале имени каталога)

</td>
</tr>
</tbody>
</table>

#### Необязательные

| Переменная | Описание | Значение по-умолчанию |
| --- | --- | --- |
| `options` | Словарь параметров Remmina из секции `[remmina_pref]`, значения которых подменяются в конфигурационном файле приложения (`~/snap/remmina/current/.config/remmina/remmina.pref`).<br/><br/>ВНИМАНИЕ! Boolean-значения параметров должны задаваться только в виде строк `'true'` или `'false'`. | `{}` |
| `secret` |  Секрет приложения для шифрования паролей в файлах-профилей соединений (см. ниже) | &mdash; |

## Пример

```yaml
- role: remmina
  vars:
    connections_dir: '{{ ansible_user_dir }}/snap/remmina/common/connections'
    options:
      disable_tray_icon: 'true'
      prevent_snap_welcome_message: 'true'
      view_file_mode: 1
    secret: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      36646335306633363036393562326663353732346366383638373231333236303939333263623265
      ...
```

## Особенности установки

На уровне Snap *не* делается привязка к Snap-интерфейсу `:password-manager-service`.
С помощью этого интерфейса пароли профилей хостов сохраняются в **Gnome Keyring**.
Это неудобно, если профили хостов синхронизируются между разными компьютерами.

Когда отключен данный интерфейс, пароли хранятся в зашифрованном виде _в самих файлах-профилях_ хостов.
Ключ шифрования располагается в конфигурационном файле приложения в параметре `secret`. 
Ключ генерируется автоматически после первого запуска приложения.

Если определена переменная `secret`, то осуществляется подмена сгенерированного приложением
секрета на указанное в переменной значение. Разумеется, это значение необходимо хранить
зашифрованным с помощью системы **Ansible Vault** ([docs](https://docs.ansible.com/ansible/latest/user_guide/vault.html)):

1. Создать файл с паролем, если его еще нет (не должен храниться в git):

   ```bash
   vim .vault-pass && chmod 600 .vault-pass
   ```

1. Зашифровать секрет (без сохранения секретов в истории команд оболочки):

   ```bash
   ansible-vault encrypt_string --stdin-name secret
   ```

   Параметр `--vault-password-file` указывать не надо, так как файл с паролем `.vault-pass` уже указан в `ansible.cfg`.

1. Скопи-пастить определение переменной `secret` в плейбук:

   ```yaml
   - role: remmina
     vars:
       secret: !vault |
         $ANSIBLE_VAULT;1.1;AES256
         ...
   ```

## После установки

1. Скопировать файлы-профили соединений в каталог `~/snap/remmina/common/connections`

## Настройка соединений

Чтобы у SSH-соединения был виден курсор необходимо у профиля менять **Terminal colour scheme**:
* `Argonaut` - для прод-сред
* `Gruvbox` - для остальных
