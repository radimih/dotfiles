---
- name: Получить недостающие факты о хосте
  ansible.builtin.setup:
    gather_subset: min
  when: ansible_distribution_release is not defined

- name: Block to set become=true on all role tasks
  become: true
  block:
    - name: Install apt key for repository of '{{ package_name }}' package
      ansible.builtin.get_url:
        url: '{{ key_url }}'
        dest: '{{ key_file }}'
        mode: 0644

    - name: Install repository of '{{ package_name }}' package
      ansible.builtin.apt_repository:
        repo: deb [arch=amd64 signed-by={{ key_file }}] {{ repo_url }} {{ ansible_distribution_release }} {{ repo_component }}
        state: present

    - name: Install '{{ package_name }}' package
      ansible.builtin.apt:
        name: '{{ package_name }}'
        state: present
        update_cache: true
        cache_valid_time: 7200  # apt update если кэш не обновлялся более 2 часов
