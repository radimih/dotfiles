# https://github.com/romkatv/powerlevel10k
---

- name: Установить промпт Powerlevel10k (p10k)
  when: prompt == 'p10k'
  block:

    - name: Скопировать файл настроек Powerlevel10k
      ansible.builtin.copy:
        src: files/.p10k.zsh
        dest: '{{ ansible_user_dir }}/{{ zsh_home_subdir }}'
        owner: '{{ ansible_user_id }}'
        group: '{{ ansible_user_id }}'
        mode: 0644

    - name: Включить режим "Instant Prompt"
      ansible.builtin.copy:
        dest: '{{ ansible_env.ZSHRC_DIR }}/00-p10k-instant-prompt.zsh'
        mode: 0644
        content: |
          # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
          # #  Managed by Ansible                                                     # #
          # #  DO NOT EDIT THIS FILE MANUALLY                                         # #
          # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #

          # Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
          # Initialization code that may require console input (password prompts, [y/n]
          # confirmations, etc.) must go above this block; everything else may go below.
          if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
            source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
          fi

    - name: Включить загрузку файла настроек Powerlevel10k
      ansible.builtin.copy:
        dest: '{{ ansible_env.ZSHRC_DIR }}/10-p10k-enable.zsh'
        mode: 0644
        content: |
          # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
          # #  Managed by Ansible                                                     # #
          # #  DO NOT EDIT THIS FILE MANUALLY                                         # #
          # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #

          # To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
          [[ ! -f ${ZDOTDIR:-~}/.p10k.zsh ]] || source ${ZDOTDIR:-~}/.p10k.zsh

- name: Удалить промпт Powerlevel10k (p10k)
  when: prompt != 'p10k'
  block:

    - name: Удалить конфигурационные файлы промпта Powerlevel10k (p10k)
      ansible.builtin.file:
        path: '{{ item }}'
        state: absent
      loop:
        - '{{ ansible_user_dir }}/{{ zsh_home_subdir }}/.p10k.zsh'
        - '{{ ansible_env.ZSHRC_DIR }}/00-p10k-instant-prompt.zsh'
        - '{{ ansible_env.ZSHRC_DIR }}/10-p10k-enable.zsh'
