---
- name: Установить пакет zsh и сопутствующие
  become: yes
  package:
    name:
      - zsh
      - git
    state: present

- name: Определить местонахождение бинарника zsh
  command: which zsh
  register: which_result
  ignore_errors: yes

- name: Установить zsh shell-оболочкой по-умолчанию
  become: yes
  user:
    name: "{{ ansible_env.USER }}"
    shell: "{{ which_result.stdout }}"
  when: which_result.rc == 0
