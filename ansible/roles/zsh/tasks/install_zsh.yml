---
- name: Установить пакет приложения
  ansible.builtin.package:
    name: zsh
    state: present
  become: true

- name: Определить местонахождение бинарника zsh
  ansible.builtin.command: which zsh
  register: r__which_result
  ignore_errors: true
  changed_when: false

- name: Установить zsh shell-оболочкой по-умолчанию
  ansible.builtin.user:
    name: '{{ ansible_user_id }}'
    shell: '{{ r__which_result.stdout }}'
  become: true
  when: r__which_result.rc == 0

- name: Создать каталог ZDOTDIR (~/{{ _zdotdir_subdir }})
  ansible.builtin.file:
    path: '{{ ansible_user_dir }}/{{ _zdotdir_subdir }}'
    state: directory
    mode: 0750

- name: Настроить стартовый файл ~/.zshenv
  ansible.builtin.copy:
    content: |
      # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
      # #  Managed by Ansible                                                     # #
      # #  DO NOT EDIT THIS FILE MANUALLY                                         # #
      # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #

      # .zshenv - Zsh environment file, загружается всегда

      export ZDOTDIR=~/{{ _zdotdir_subdir }}
      [[ -f $ZDOTDIR/.zshenv ]] && . $ZDOTDIR/.zshenv
    dest: '{{ ansible_user_dir }}/.zshenv'
    mode: 0644

- name: Скопировать файлы настроек zsh
  ansible.builtin.copy:
    src: files/{{ item }}
    dest: '{{ ansible_user_dir }}/{{ _zdotdir_subdir }}'
    owner: '{{ ansible_user_id }}'
    group: '{{ ansible_user_id }}'
    mode: 0644
  loop:
    - .zshrc
    - .zshenv
